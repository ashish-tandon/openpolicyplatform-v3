#!/bin/bash

echo "ğŸ”§ Adding Missing OpenPolicy API Container"
echo "========================================="
echo ""

echo "ğŸ“‹ Current Status:"
echo "=================="
echo "âœ… Dashboard: http://192.168.2.152:3000 (Working)"
echo "âœ… Flower Monitor: http://192.168.2.152:5555 (Working)"
echo "âŒ API: http://192.168.2.152:8000 (Missing Container)"
echo ""

echo "ğŸš€ Step-by-Step Instructions:"
echo "============================"
echo ""
echo "1. ğŸ“± Open Container Station:"
echo "   http://192.168.2.152:8080"
echo ""
echo "2. ğŸ³ Click 'Create' â†’ 'Application'"
echo ""
echo "3. ğŸ” Search for this exact image:"
echo "   ashishtandon9/openpolicyashback:latest"
echo ""
echo "4. âš™ï¸ Configure the container:"
echo "   â€¢ Container name: openpolicy_api"
echo "   â€¢ Port mapping: 8000:8000"
echo ""
echo "5. ğŸ”§ Environment Variables (Add these one by one):"
echo "   â€¢ DB_HOST = openpolicy_postgres"
echo "   â€¢ DB_PORT = 5432"
echo "   â€¢ DB_NAME = opencivicdata"
echo "   â€¢ DB_USER = openpolicy"
echo "   â€¢ DB_PASSWORD = openpolicy123"
echo "   â€¢ REDIS_URL = redis://openpolicy_redis:6379/0"
echo "   â€¢ CORS_ORIGINS = http://192.168.2.152:3000,http://localhost:3000"
echo ""
echo "6. ğŸ“ Volume Mappings (Add these one by one):"
echo "   â€¢ /share/Container/openpolicy/regions_report.json:/app/regions_report.json:ro"
echo "   â€¢ /share/Container/openpolicy/scrapers:/app/scrapers:ro"
echo ""
echo "7. âœ… Click 'Create'"
echo ""
echo "8. â–¶ï¸ Start the container"
echo ""

echo "â±ï¸ Expected Timeline:"
echo "===================="
echo "â€¢ Container startup: 2-3 minutes"
echo "â€¢ Database connection: 1-2 minutes"
echo "â€¢ Health check: 30 seconds"
echo "â€¢ System operational: 5 minutes total"
echo ""

echo "ğŸ§ª Test After Creation:"
echo "======================"
echo "1. Test API Health:"
echo "   curl http://192.168.2.152:8000/health"
echo ""
echo "2. Test API Docs:"
echo "   http://192.168.2.152:8000/docs"
echo ""
echo "3. Test Dashboard (should now show real data):"
echo "   http://192.168.2.152:3000"
echo ""

echo "ğŸ¯ Success Indicators:"
echo "====================="
echo "âœ… API responds at http://192.168.2.152:8000/health"
echo "âœ… Dashboard loads real data"
echo "âœ… Flower monitor shows active tasks"
echo "âœ… All containers in 'Running' status"
echo ""

echo "ğŸ“Š After API is Working:"
echo "======================="
echo "â€¢ First data scraping: 15-30 minutes"
echo "â€¢ Complete data collection: 2-4 hours"
echo "â€¢ Real-time updates: Continuous"
echo ""

echo "ğŸš€ Ready to add the API container!"
echo "Follow the steps above and your OpenPolicy system will be complete!" 