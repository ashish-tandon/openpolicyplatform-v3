#!/bin/bash

echo "ğŸ”§ Restarting Container with Fixed Database"
echo "=========================================="
echo ""

echo "ğŸ“‹ Issue Identified and Fixed:"
echo "=============================="
echo "âŒ Database initialization error: 'engine' not found"
echo "âœ… Fixed database configuration"
echo "âœ… Added engine export to config.py"
echo "âœ… New Docker image built and pushed"
echo ""

echo "ğŸš€ Restart Instructions:"
echo "======================="
echo ""
echo "1. ğŸ“± Open Container Station:"
echo "   http://192.168.2.152:8080"
echo ""
echo "2. ğŸ” Find your OpenPolicy application"
echo "   - Look for 'OpenPolicyAshBack' application"
echo ""
echo "3. â¹ï¸ Stop the Application:"
echo "   - Click on the application"
echo "   - Click 'Stop'"
echo "   - Wait for container to stop"
echo ""
echo "4. ğŸ”„ Update the Container:"
echo "   - Click on the application"
echo "   - Click 'Update' or 'Recreate'"
echo "   - This will pull the latest fixed image"
echo "   - Wait for update to complete"
echo ""
echo "5. â–¶ï¸ Start the Application:"
echo "   - Click 'Start'"
echo "   - Wait 2-3 minutes for startup"
echo ""

echo "â±ï¸ Expected Timeline:"
echo "===================="
echo "â€¢ Stop application: 1 minute"
echo "â€¢ Update container: 2-3 minutes"
echo "â€¢ Start application: 2-3 minutes"
echo "â€¢ Database init: 30 seconds"
echo "â€¢ API ready: 1 minute"
echo "â€¢ Total time: 6-8 minutes"
echo ""

echo "ğŸ§ª Test After Restart:"
echo "====================="
echo "1. Test API Health:"
echo "   curl http://192.168.2.152:8000/health"
echo ""
echo "2. Test API Docs:"
echo "   http://192.168.2.152:8000/docs"
echo ""
echo "3. Test Dashboard:"
echo "   http://192.168.2.152:3000"
echo ""
echo "4. Test Flower Monitor:"
echo "   http://192.168.2.152:5555"
echo ""

echo "ğŸ¯ Success Indicators:"
echo "====================="
echo "âœ… Container status: 'Running'"
echo "âœ… API responds at http://192.168.2.152:8000/health"
echo "âœ… Dashboard loads at http://192.168.2.152:3000"
echo "âœ… Flower monitor accessible at http://192.168.2.152:5555"
echo "âœ… No database initialization errors in logs"
echo ""

echo "ğŸ“Š After Restart:"
echo "================"
echo "â€¢ Database will be initialized with SQLite"
echo "â€¢ All services will start properly"
echo "â€¢ First data scraping: 15-30 minutes"
echo "â€¢ Complete setup: 2-4 hours"
echo ""

echo "ğŸš€ Ready to restart!"
echo "The database initialization error has been fixed." 