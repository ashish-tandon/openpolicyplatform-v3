#!/bin/bash

echo "ğŸ”„ Recreating Container Station Application"
echo "=========================================="
echo ""

echo "ğŸ“‹ Current Status:"
echo "=================="
echo "âœ… Configuration files updated correctly"
echo "âœ… API service defined in docker-compose.yml"
echo "âŒ API container still not starting"
echo ""

echo "ğŸš€ Solution: Recreate the Application"
echo "===================================="
echo ""
echo "Sometimes Container Station needs the application to be completely"
echo "recreated rather than just restarted. Here's what to do:"
echo ""
echo "1. ğŸ“± Open Container Station:"
echo "   http://192.168.2.152:8080"
echo ""
echo "2. ğŸ” Find your OpenPolicy application"
echo "   - Look for the docker-compose application"
echo "   - Note which containers are currently running"
echo ""
echo "3. â¹ï¸ Stop the Application:"
echo "   - Click on the application"
echo "   - Click 'Stop' or 'Stop All'"
echo "   - Wait for all containers to stop"
echo ""
echo "4. ğŸ—‘ï¸ Delete the Application:"
echo "   - Click on the application"
echo "   - Click 'Delete' or 'Remove'"
echo "   - Confirm deletion"
echo "   - This will NOT delete your data (it's in volumes)"
echo ""
echo "5. ğŸ†• Create New Application:"
echo "   - Click 'Create' â†’ 'Application'"
echo "   - Click 'Import from docker-compose.yml'"
echo "   - Upload: /share/Container/openpolicy/docker-compose.yml"
echo "   - Click 'Create'"
echo ""
echo "6. â–¶ï¸ Start the New Application:"
echo "   - Click 'Start' or 'Start All'"
echo "   - Wait 3-5 minutes for all containers to start"
echo ""
echo "7. âœ… Verify All Containers:"
echo "   - Check that ALL containers are running:"
echo "     â€¢ openpolicy_postgres"
echo "     â€¢ openpolicy_redis"
echo "     â€¢ openpolicy_api"
echo "     â€¢ openpolicy_worker"
echo "     â€¢ openpolicy_beat"
echo "     â€¢ openpolicy_flower"
echo "     â€¢ openpolicy_dashboard"
echo ""

echo "â±ï¸ Expected Timeline:"
echo "===================="
echo "â€¢ Stop application: 1-2 minutes"
echo "â€¢ Delete application: 30 seconds"
echo "â€¢ Create new application: 1-2 minutes"
echo "â€¢ Start all containers: 3-5 minutes"
echo "â€¢ API container startup: 2-3 minutes"
echo "â€¢ Total time: 8-12 minutes"
echo ""

echo "ğŸ§ª Test After Recreation:"
echo "========================"
echo "1. Test API Health:"
echo "   curl http://192.168.2.152:8000/health"
echo ""
echo "2. Test API Docs:"
echo "   http://192.168.2.152:8000/docs"
echo ""
echo "3. Test Dashboard:"
echo "   http://192.168.2.152:3000"
echo ""
echo "4. Run Full Validation:"
echo "   ./final-validation.sh"
echo ""

echo "ğŸ¯ Success Indicators:"
echo "====================="
echo "âœ… All 7 containers in 'Running' status"
echo "âœ… API responds at http://192.168.2.152:8000/health"
echo "âœ… Dashboard loads real data"
echo "âœ… Flower monitor shows active tasks"
echo ""

echo "ğŸ“Š After Recreation:"
echo "==================="
echo "â€¢ First data scraping: 15-30 minutes"
echo "â€¢ Complete collection: 2-4 hours"
echo "â€¢ Real-time updates: Continuous"
echo ""

echo "ğŸš€ Ready to recreate!"
echo "This will ensure all containers start properly." 